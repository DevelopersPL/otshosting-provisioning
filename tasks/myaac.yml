---
- name: Install MyAAC dependencies
  apt:
    name:
      - npm
    state: present

- name: Clone MyAAC from Github
  git:
    repo: https://github.com/slawkens/myaac.git
    dest: /home/otsmanager/www/public_html
  become: true
  become_user: otsmanager

- name: Install composer dependencies
  composer:
    command: install
    working_dir: /home/otsmanager/www/public_html
    no_dev: true
    prefer_dist: true
  become: true
  become_user: otsmanager

- name: Install npm dependencies
  npm:
    path: /home/otsmanager/www/public_html
    production: true
  become: true
  become_user: otsmanager

- name: Create config.local.php
  copy:
    dest: /home/otsmanager/www/public_html/config.local.php
    content: |
      <?php
      $config['installed'] = true;
      $config['env'] = 'prod';
      $config['site_url'] = 'https://testing-server.ots.ovh';
      $config['server_path'] = '/home/otsmanager/forgottenserver/';
      $config['gzip_output'] = false;
      $config['cache_engine'] = 'auto';
      $config['cache_prefix'] = 'myaac_9rat8n32';
      $config['database_auto_migrate'] = true;
    owner: otsmanager
    group: otsmanager
    mode: '0644'
